<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Androiddbhelper : Android DbHelper" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Androiddbhelper</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/FabianCook/AndroidDbHelper">View on GitHub</a>

          <h1 id="project_title">Androiddbhelper</h1>
          <h2 id="project_tagline">Android DbHelper</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/FabianCook/AndroidDbHelper/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/FabianCook/AndroidDbHelper/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>DbHelper for android</p>

<p>Creating an instance of DbHelper:</p>

<div class="highlight highlight-java"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span>  
    <span class="kd">implements</span> <span class="n">DbHelper</span><span class="o">.</span><span class="na">OnDatabaseLoadedListener</span><span class="o">{</span>

    <span class="kd">private</span> <span class="n">DatabaseSchema</span> <span class="n">mSchema</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">DbHelper</span> <span class="n">mDbHelper</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">b</span><span class="o">){</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
        <span class="n">mSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatabaseSchema</span><span class="o">();</span>
        <span class="n">mSchema</span><span class="o">.</span><span class="na">Version</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="n">mSchema</span><span class="o">.</span><span class="na">Context</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getApplicationContext</span><span class="o">();</span>
        <span class="n">mSchema</span><span class="o">.</span><span class="na">Location</span> <span class="o">=</span> <span class="n">DatabaseSchema</span><span class="o">.</span><span class="na">DatabaseLocation</span><span class="o">.</span><span class="na">ApplicationData</span><span class="o">;</span>
        <span class="n">mSchema</span><span class="o">.</span><span class="na">Name</span> <span class="o">=</span> <span class="s">"Test.db"</span><span class="o">;</span>
        <span class="n">mSchema</span><span class="o">.</span><span class="na">CursorFactory</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">mSchema</span><span class="o">.</span><span class="na">OnCreateScrips</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span>
                <span class="s">"CREATE TABLE IF NOT EXISTS test1 (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT)"</span><span class="o">,</span>
                <span class="s">"CREATE TABLE IF NOT EXISTS test2 (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT)"</span>
        <span class="o">};</span>
        <span class="kt">boolean</span> <span class="n">async</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="n">DbHelper</span><span class="o">.</span><span class="na">OnDatabaseLoadedListener</span> <span class="n">listener</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="n">mDbHelper</span> <span class="o">=</span> <span class="n">DbHelper</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">mSchema</span><span class="o">,</span> <span class="n">async</span><span class="o">,</span> <span class="n">listener</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>Once the database is loaded you can start executing queries:</p>

<div class="highlight highlight-java"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span>  
    <span class="kd">implements</span> <span class="n">DbHelper</span><span class="o">.</span><span class="na">OnDatabaseLoadedListener</span><span class="o">,</span> 
                <span class="n">SQLiteInsertStatement</span><span class="o">.</span><span class="na">OnResultListener</span><span class="o">,</span> 
                <span class="n">SQLiteSelectStatement</span><span class="o">.</span><span class="na">OnResultListener</span> <span class="o">{</span>

    <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDatabaseLoaded</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"Database"</span><span class="o">,</span> <span class="s">"Database loaded"</span><span class="o">);</span>

        <span class="n">SQLiteInsertStatement</span> <span class="n">insertStatement</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SQLiteInsertStatement</span><span class="o">();</span>

        <span class="n">ContentValues</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ContentValues</span><span class="o">();</span>
        <span class="n">values</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"Test name"</span><span class="o">);</span>
        <span class="n">insertStatement</span><span class="o">.</span><span class="na">setContentValues</span><span class="o">(</span><span class="n">values</span><span class="o">);</span>
        <span class="n">insertStatement</span><span class="o">.</span><span class="na">setTable</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
        <span class="n">insertStatement</span><span class="o">.</span><span class="na">setOnResultListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="n">mDbHelper</span><span class="o">.</span><span class="na">Execute</span><span class="o">(</span><span class="n">insertStatement</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDatabaseError</span><span class="o">(</span><span class="n">String</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"Database"</span><span class="o">,</span> <span class="n">error</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onInsertResult</span><span class="o">(</span><span class="n">SQLiteInsertStatement</span> <span class="n">statement</span><span class="o">,</span> <span class="kt">long</span> <span class="n">insertedId</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"Database"</span><span class="o">,</span> <span class="s">"Inserted: "</span> <span class="o">+</span> <span class="n">insertedId</span><span class="o">);</span>

        <span class="n">SQLiteSelectStatement</span> <span class="n">selectStatement</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SQLiteSelectStatement</span><span class="o">();</span>
        <span class="n">selectStatement</span><span class="o">.</span><span class="na">setQuery</span><span class="o">(</span><span class="s">"SELECT name FROM test"</span><span class="o">);</span>
        <span class="n">selectStatement</span><span class="o">.</span><span class="na">setOnResultListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="n">mDbHelper</span><span class="o">.</span><span class="na">Execute</span><span class="o">(</span><span class="n">selectStatement</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStringResult</span><span class="o">(</span><span class="n">SQLiteSelectStatement</span> <span class="n">statement</span><span class="o">,</span> <span class="n">String</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"Database"</span><span class="o">,</span> <span class="s">"Selected: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStringArrayResult</span><span class="o">(</span><span class="n">SQLiteSelectStatement</span> <span class="n">statement</span><span class="o">,</span>
            <span class="n">String</span><span class="o">[]</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onCursorResult</span><span class="o">(</span><span class="n">SQLiteSelectStatement</span> <span class="n">statement</span><span class="o">,</span> <span class="n">Cursor</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>Remember to open and close the database when you aren't using it using:</p>

<div class="highlight highlight-java"><pre><span class="c1">//This will open a new database object </span>
<span class="c1">//if there isn't already one there</span>
<span class="n">mDbHelper</span><span class="o">.</span><span class="na">open</span><span class="o">();</span> 

<span class="c1">//This will close the database object</span>
<span class="c1">//and stop any transactions if needed</span>
<span class="n">mDbHelper</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</pre></div>

<p>If you wish to use the database object yourself you can use</p>

<div class="highlight highlight-java"><pre><span class="c1">//This will always get a Writable database</span>
<span class="c1">//as you can both read and write from it</span>
<span class="c1">//If their is one still open it will use</span>
<span class="c1">//that</span>
<span class="n">mDbHelper</span><span class="o">.</span><span class="na">getDatabase</span><span class="o">();</span>
</pre></div>

<p>To create a database use a DatabaseSchema object, this will provide the details needed
to create the DbHelper:</p>

<div class="highlight highlight-java"><pre><span class="n">DatabaseSchema</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatabaseSchema</span><span class="o">();</span>

<span class="c1">//This needs to be above 1</span>
<span class="n">schema</span><span class="o">.</span><span class="na">Version</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

<span class="c1">//The name of the database</span>
<span class="n">schema</span><span class="o">.</span><span class="na">Name</span> <span class="o">=</span> <span class="s">"Test.db"</span><span class="o">;</span>

<span class="c1">//You can specify whether you want the database to be stored</span>
<span class="c1">//in a specific directory or with the applications data</span>
<span class="c1">//schema.Location = DatabaseSchema.DatabaseLocation.Directory;</span>
<span class="n">schema</span><span class="o">.</span><span class="na">Location</span> <span class="o">=</span> <span class="n">DatabaseSchema</span><span class="o">.</span><span class="na">DatabaseLocation</span><span class="o">.</span><span class="na">ApplicationData</span><span class="o">;</span>

<span class="c1">//When you specify schema.Location as directory set the directory</span>
<span class="c1">//Make sure you have access to this</span>
<span class="c1">//Also make sure you have write to external storage enabled</span>
<span class="c1">//schema.Directory = "/sdcard/TestDatabase/";</span>

<span class="c1">//When you have schema.Location as ApplicationData you</span>
<span class="c1">//can set the context of the database</span>
<span class="n">schema</span><span class="o">.</span><span class="na">Context</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getApplicationContext</span><span class="o">();</span>

<span class="c1">//The CursorFactory for the database</span>
<span class="c1">//null for default</span>
<span class="n">schema</span><span class="o">.</span><span class="na">CursorFactory</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="c1">//The scripts to run when the database is created</span>
<span class="n">schema</span><span class="o">.</span><span class="na">OnCreateScrips</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span>
    <span class="s">"CREATE TABLE IF NOT EXISTS test (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT)"</span>
<span class="o">};</span>

<span class="c1">//The scrips to run on each upgrade, the ones that are run are </span>
<span class="c1">//set by changing the version number.</span>

<span class="n">DatabaseSchemaUpgrade</span> <span class="n">upgrade</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatabaseSchemaUpgrade</span><span class="o">();</span>
<span class="c1">//This will only be run when the old version of the database is under 2</span>
<span class="c1">//and the new version is equal to or over 2</span>
<span class="n">upgrade</span><span class="o">.</span><span class="na">UpgradeVersion</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>

<span class="c1">//The scripts to run when this upgrade is run</span>
<span class="n">upgrade</span><span class="o">.</span><span class="na">OnUpgradeScripts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span>
    <span class="s">"DROP TABLE test"</span>
<span class="o">};</span>

<span class="c1">//Flag to say whether onCreate should be called post to running these scripts</span>
<span class="c1">//This is good in the case of drop table scripts.</span>
<span class="n">upgrade</span><span class="o">.</span><span class="na">CreatePost</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

<span class="c1">//Set the upgrade scripts to run</span>
<span class="n">mSchema</span><span class="o">.</span><span class="na">OnUpgradeScripts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatabaseSchemaUpgrade</span><span class="o">[]{</span><span class="n">upgrade</span><span class="o">};</span>
</pre></div>

<p>You can change whether to run the scripts in an asynchronous way or a synchronous way</p>

<div class="highlight highlight-java"><pre><span class="c1">//tells us whether the database is running in an asynchronous way or not</span>
<span class="n">mDbHelper</span><span class="o">.</span><span class="na">isAsync</span><span class="o">();</span><span class="c1">//This is the same as mDbHelper.isAsynchronous();</span>

<span class="c1">//Default true, sets whether the database should run in an</span>
<span class="c1">//asynchronous way</span>
<span class="n">mDbHelper</span><span class="o">.</span><span class="na">setAsync</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span><span class="c1">//This is the same as mDbHelper.setAsynchronous(boolean async);</span>
</pre></div>

<p>You can specify different things when creating the database helper</p>

<div class="highlight highlight-java"><pre><span class="c1">//Default constructor </span>
<span class="n">DbHelper</span> <span class="n">dbHelper</span> <span class="o">=</span> <span class="n">DbHelper</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">DatabaseSchema</span> <span class="n">schema</span><span class="o">);</span>

<span class="c1">//Specify a on database load listener</span>
<span class="n">DbHelper</span> <span class="n">dbHelper</span> <span class="o">=</span> <span class="n">DbHelper</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">DatabaseSchema</span> <span class="n">schema</span><span class="o">,</span> <span class="n">DbHelper</span><span class="o">.</span><span class="na">OnDatabaseLoadedListener</span> <span class="n">listener</span><span class="o">);</span>

<span class="c1">//Specify a on database load listener and whether the database is asynchronous</span>
<span class="n">DbHelper</span> <span class="n">dbHelper</span> <span class="o">=</span> <span class="n">DbHelper</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">DatabaseSchema</span> <span class="n">schema</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">async</span><span class="o">,</span> <span class="n">DbHelper</span><span class="o">.</span><span class="na">OnDatabaseLoadedListener</span> <span class="n">listener</span><span class="o">);</span>
</pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Androiddbhelper maintained by <a href="https://github.com/FabianCook">FabianCook</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
